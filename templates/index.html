<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>autodescemas</title>
</head>
<body>
    <button style="width:300px; height:300px;" id="start">작동</button>
    <button style="width:300px; height:300px;" id="stop">중지</button>
    <script>
        let running = false;
        let lt = '';

        async function onClipboardChange(text) {
            if (!running) return;
            if (!text || text === lt) return;

            lt = text;

            try {
                const response = await fetch('/process', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });

                const data = await response.json();
                await navigator.clipboard.writeText(data.text);

                console.log(data.text);
            } catch (e) {
                console.error(e);
            }
        }

        document.getElementById("start").onclick = async () => {
            if (running) return;
            running = true;

            try {
                lt = await navigator.clipboard.readText();
            } catch (e) {
                console.warn("1");
            }

            console.log("작동");
        };

        document.getElementById("stop").onclick = () => {
            running = false;
            console.log("중지");
        };

        navigator.clipboard.addEventListener("clipboardchange", async (e) => {
            const text = await e.clipboardData.getText("text/plain");
            onClipboardChange(text);
        });
    </script>
</body>
</html>